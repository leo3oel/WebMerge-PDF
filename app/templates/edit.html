<!doctype html>
<link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
<title>Edit PDF Files</title>
<h1>Edit PDF Files</h1>
<form method="post" style="display:flex; flex-direction:column; gap:6px; margin-left:12px; width:fit-content;">
    <button name="action" value="save" class="btn btn-submit">Save</button>
    <button name="action" value="back" class="btn btn-back">‚Üê Go Back to Selection</button>
</form>

{% for file in pdf_files %}
<div style="display: flex; align-items: center; 
{%- if loop.first %}
    margin-top: 12px; border-top:1px solid #eee; padding-top:8px;
{% endif -%}
    margin-bottom: 12px; gap:8px; border-bottom:1px solid #eee; padding-bottom:8px;">
    <div style="flex:0 0 360px;">
        <iframe src="{{ file.url }}" width="{{ PDFWIDTH }}px" height="{{ PDFHEIGHT }}px"
            style="border:1px solid #ccc;"></iframe>
    </div>
    <div style="flex:0 1 auto; display:flex; flex-direction:column; gap:6px; padding-left:12px;">
        <div style="font-weight:600;">{{ file.filename }}</div>
        <div style="color:#666;">Size: {{ file.filesize_str }} ¬∑ Modified: {{ file.timestamp_str }} ¬∑ Pages: {{
            file.num_pages }}</div>
    </div>
    <form method="post" style="display: flex; flex-direction: column; gap:6px;  margin-left:12px; padding-left:50px">
        <input type="hidden" name="filename" value="{{ file.filename }}">
        {%- if loop.first %}
        <button name="action" disabled value="up" class="btn">‚¨ÜÔ∏è Move Up</button>
        {% else %}
        <button name="action" value="up" class="btn">‚¨ÜÔ∏è Move Up</button>
        {% endif -%}
        {%- if loop.last %}
        <button class="btn" disabled style="padding:6px 10px;">‚¨áÔ∏è Move Down</button>
        {% else %}
        <button name="action" value="down" class="btn">‚¨áÔ∏è Move Down</button>
        {% endif -%}
        <button name="action" value="rotate_cw" class="btn">‚ü≥ Rotate CW</button>
        <button name="action" value="rotate_ccw" class="btn">‚ü≤ Rotate CCW</button>
        {%- if file.num_pages > 1 %}
        <button name="action" value="split_pdf" class="btn">‚úÇÔ∏è Split PDF</button>
        {% else %}
        <button class="btn" disabled style="padding:6px 10px;">‚úÇÔ∏è Split PDF</button>
        {% endif -%}
        <button type="button" onclick="deleteFile('{{ file.filename }}')" class="btn btn-delete">üóëÔ∏è Delete</button>
    </form>
</div>
{%- endfor %}

<form method="post" style="display:flex; flex-direction:column; gap:6px; margin-left:12px; width:fit-content;">
    <button name="action" value="save" class="btn btn-submit">Save</button>
    <button name="action" value="back" class="btn btn-back">‚Üê Go Back to Selection</button>
</form>

<!-- hidden delete form (POST) to avoid nested forms; JS will populate and submit it -->
<form id="deleteForm" method="post" style="display:none;">
    <input type="hidden" name="action" value="delete">
    <input type="hidden" name="filename" id="deleteFilename" value="">
</form>

<script>
    function deleteFile(filename) {
        {
            if (!confirm("Delete '" + filename + "'? This will remove the file from disk.")) return;
            const f = document.getElementById('deleteFilename');
            f.value = filename;
            document.getElementById('deleteForm').submit();
        }
    }
</script>